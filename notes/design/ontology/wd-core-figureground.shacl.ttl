@prefix wd: <https://paperhat.dev/ns/wd#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .

#####################################################################
# Figureâ€“Ground constraints (only defined here; not duplicated elsewhere)
#####################################################################

wd:FigureGroundShape
  a sh:NodeShape ;
  sh:targetClass wd:FigureGroundStatement ;

  sh:property [
    sh:path wd:principleType ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:hasValue wd:FigureGround ;
  ] ;

  sh:property [
    sh:path wd:scope ;
    sh:minCount 1 ; sh:maxCount 1 ;
  ] ;

  sh:property [
    sh:path wd:participant ;
    sh:minCount 1 ;
    sh:class wd:ElementInstance ;
  ] ;

  sh:property [
    sh:path wd:foreground ;
    sh:minCount 1 ;
    sh:class wd:ElementInstance ;
  ] ;

  sh:property [
    sh:path wd:background ;
    sh:minCount 1 ;
    sh:or (
      [ sh:class wd:ElementInstance ]
      [ sh:class wd:Region ]
    ) ;
  ] ;

  ###################################################################
  # foreground-implies-participant: every foreground must also be a participant
  ###################################################################
  sh:sparql [
    a sh:SPARQLConstraint ;
    sh:message "Every wd:foreground element must also be a wd:participant of this FigureGroundStatement." ;
    sh:select """
      PREFIX wd: <https://paperhat.dev/ns/wd#>
      SELECT $this ?e
      WHERE {
        $this wd:foreground ?e .
        FILTER NOT EXISTS { $this wd:participant ?e . }
      }
    """ ;
  ] .
