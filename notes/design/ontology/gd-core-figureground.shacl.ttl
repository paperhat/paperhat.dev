@prefix gd: <https://paperhat.dev/ns/gd#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .

#####################################################################
# Figureâ€“Ground constraints (only defined here; not duplicated elsewhere)
#####################################################################

gd:FigureGroundShape
  a sh:NodeShape ;
  sh:targetClass gd:FigureGroundStatement ;

  sh:property [
    sh:path gd:principleType ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:hasValue gd:FigureGround ;
  ] ;

  sh:property [
    sh:path gd:scope ;
    sh:minCount 1 ; sh:maxCount 1 ;
  ] ;

  sh:property [
    sh:path gd:participant ;
    sh:minCount 1 ;
    sh:class gd:ElementInstance ;
  ] ;

  sh:property [
    sh:path gd:foreground ;
    sh:minCount 1 ;
    sh:class gd:ElementInstance ;
  ] ;

  sh:property [
    sh:path gd:background ;
    sh:minCount 1 ;
    sh:or (
      [ sh:class gd:ElementInstance ]
      [ sh:class gd:Region ]
    ) ;
  ] ;

  ###################################################################
  # foreground-implies-participant: every foreground must also be a participant
  ###################################################################
  sh:sparql [
    a sh:SPARQLConstraint ;
    sh:message "Every gd:foreground element must also be a gd:participant of this FigureGroundStatement." ;
    sh:select """
      PREFIX gd: <https://paperhat.dev/ns/gd#>
      SELECT $this ?e
      WHERE {
        $this gd:foreground ?e .
        FILTER NOT EXISTS { $this gd:participant ?e . }
      }
    """ ;
  ] .
