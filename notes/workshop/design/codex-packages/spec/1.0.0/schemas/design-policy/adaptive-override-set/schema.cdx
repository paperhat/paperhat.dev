<Schema
	id=codex:design-policy:adaptive-override-set
	version="1.0.0"
	versionScheme=$Semver
	authoringMode=$SimplifiedMode
	compatibilityClass=$Initial
	namespace="adaptive-override"
	title="Adaptive Override Set Schema"
	description="Human-authored override constraints injected into deterministic adaptive optimization."
>
	<ConceptDefinitions>
		<ConceptDefinition
			id=codex:design-policy:adaptive-override-set:AdaptiveOverrideSet
			name="AdaptiveOverrideSet"
			conceptKind=$Semantic
			entityEligibility=$MustNotBeEntity
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="overrideSetId" />

				<AllowsTrait name="overrideMode" />
			</TraitRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="OverrideConstraint" />
			</ChildRules>

			<CollectionRules ordering=$Ordered allowsDuplicates=true />
		</ConceptDefinition>

		<ConceptDefinition
			id=codex:design-policy:adaptive-override-set:OverrideConstraint
			name="OverrideConstraint"
			conceptKind=$Structural
			entityEligibility=$MustNotBeEntity
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="overrideKind" />

				<RequiresTrait name="targetRef" />

				<AllowsTrait name="targetProperty" />

				<AllowsTrait name="overrideValue" />

				<AllowsTrait name="overridePriority" />

				<AllowsTrait name="expiresAt" />
			</TraitRules>
		</ConceptDefinition>
	</ConceptDefinitions>

	<TraitDefinitions>
		<TraitDefinition
			name="overrideSetId"
			defaultValueType=$IriReference
			cardinality=$Single
			isReferenceTrait=true
		/>

		<TraitDefinition
			name="overrideMode"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $strict, $advisory ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="overrideKind"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $forcePlacement, $forceSpan, $forceOrder, $pinVisible, $hideElement, $showElement, $lockGroup ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="targetRef"
			defaultValueType=$IriReference
			cardinality=$Single
			isReferenceTrait=true
		/>

		<TraitDefinition
			name="targetProperty"
			defaultValueType=$Text
			cardinality=$Single
		/>

		<TraitDefinition
			name="overrideValue"
			defaultValueType=$Text
			cardinality=$Single
		/>

		<TraitDefinition
			name="overridePriority"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $critical, $high, $medium, $low ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="expiresAt"
			defaultValueType=$PlainDateTime
			cardinality=$Single
		/>
	</TraitDefinitions>

	<ConstraintDefinitions>
		<ConstraintDefinition
			id=codex:design-policy:adaptive-override-set:requires-override-constraint
			title="AdaptiveOverrideSet must define at least one OverrideConstraint"
		>
			<Targets>
				<TargetConcept conceptSelector="AdaptiveOverrideSet" />
			</Targets>

			<Rule>
				<ChildConstraint type=$RequiresChildConcept conceptSelector="OverrideConstraint" />
			</Rule>
		</ConstraintDefinition>
	</ConstraintDefinitions>
</Schema>
