<Schema
	id="codex:domain:adaptive-plan-package"
	version="1.0.0"
	versionScheme="$Semver"
	authoringMode="$SimplifiedMode"
	compatibilityClass="$Initial"
	namespace="adaptive-plan-package"
	title="Adaptive Plan Package Schema"
	description="Deterministic Stage C canonical adaptive-plan package for foundry handoff."
>
	<ConceptDefinitions>
		<ConceptDefinition
			id="codex:domain:adaptive-plan-package:AdaptivePlanPackage"
			name="AdaptivePlanPackage"
			conceptKind="$Semantic"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="workshopVersion" />

				<RequiresTrait name="closureHash" />

				<RequiresTrait name="adaptivePlanProjectionDefinitionClosureHash" />

				<RequiresTrait name="contentHashAlgorithm" />

				<AllowsTrait name="adaptivePlanPackageContentHash" />
			</TraitRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="PayloadRecords" />
			</ChildRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-package:PayloadRecords"
			name="PayloadRecords"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="AdaptivePlanPayloadRecord" />
			</ChildRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-package:AdaptivePlanPayloadRecord"
			name="AdaptivePlanPayloadRecord"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="projectionIdentifier" />

				<RequiresTrait name="projectionDefinitionClosureHash" />

				<RequiresTrait name="parameterHash" />

				<RequiresTrait name="payloadContentHash" />

				<RequiresTrait name="payloadCanonicalBytes" />
			</TraitRules>
		</ConceptDefinition>
	</ConceptDefinitions>

	<TraitDefinitions>
		<TraitDefinition
			name="workshopVersion"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="closureHash"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="adaptivePlanProjectionDefinitionClosureHash"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="contentHashAlgorithm"
			defaultValueType="$EnumeratedToken"
			cardinality="$Single"
		>
			<AllowedValues>
				<ValueIsOneOf values="$SHA256" />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="adaptivePlanPackageContentHash"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="projectionIdentifier"
			defaultValueType="$IriReference"
			cardinality="$Single"
			isReferenceTrait="true"
		/>

		<TraitDefinition
			name="projectionDefinitionClosureHash"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="parameterHash"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="payloadContentHash"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="payloadCanonicalBytes"
			defaultValueType="$Text"
			cardinality="$Single"
		/>
	</TraitDefinitions>
</Schema>
