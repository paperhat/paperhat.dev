<Schema
	id="codex:domain:adaptive-plan-result"
	version="1.0.0"
	versionScheme="$Semver"
	authoringMode="$SimplifiedMode"
	compatibilityClass="$Initial"
	namespace="adaptive-plan-result"
	title="Adaptive Plan Result Schema"
	description="Deterministic Stage C foundry handoff envelope."
>
	<ConceptDefinitions>
		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:AdaptivePlanResult"
			name="AdaptivePlanResult"
			conceptKind="$Semantic"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="status" />

				<AllowsTrait name="error" />

				<AllowsTrait name="failedStage" />

				<AllowsTrait name="intentId" />

				<AllowsTrait name="targetFoundry" />

				<AllowsTrait name="policySetRef" />
			</TraitRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="PlanScope" />

				<AllowsChildConcept conceptSelector="StageAOutcome" />

				<AllowsChildConcept conceptSelector="StageBOutcome" />
			</ChildRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:PlanScope"
			name="PlanScope"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="compositionIri" />

				<AllowsTrait name="viewIri" />
			</TraitRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:StageAOutcome"
			name="StageAOutcome"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="SelectedActions" />

				<AllowsChildConcept conceptSelector="Delta" />
			</ChildRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:SelectedActions"
			name="SelectedActions"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="Action" />
			</ChildRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:Action"
			name="Action"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="iri" />
			</TraitRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:Delta"
			name="Delta"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="Remove" />

				<AllowsChildConcept conceptSelector="Add" />
			</ChildRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:Remove"
			name="Remove"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="triple" />
			</TraitRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:Add"
			name="Add"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="triple" />
			</TraitRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:StageBOutcome"
			name="StageBOutcome"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="selectedCandidate" />

				<RequiresTrait name="selectedScore" />
			</TraitRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="AppliedRelaxation" />
			</ChildRules>
		</ConceptDefinition>

		<ConceptDefinition
			id="codex:domain:adaptive-plan-result:AppliedRelaxation"
			name="AppliedRelaxation"
			conceptKind="$Structural"
			entityEligibility="$MustNotBeEntity"
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="relaxOrder" />

				<AllowsTrait name="relaxWeightClass" />

				<RequiresTrait name="relaxationAction" />
			</TraitRules>
		</ConceptDefinition>
	</ConceptDefinitions>

	<TraitDefinitions>
		<TraitDefinition
			name="status"
			defaultValueType="$EnumeratedToken"
			cardinality="$Single"
		>
			<AllowedValues>
				<ValueIsOneOf values="$ok,$error" />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="error"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="failedStage"
			defaultValueType="$EnumeratedToken"
			cardinality="$Single"
		>
			<AllowedValues>
				<ValueIsOneOf values="$stageA,$stageB" />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="intentId"
			defaultValueType="$IriReference"
			cardinality="$Single"
			isReferenceTrait="true"
		/>

		<TraitDefinition
			name="targetFoundry"
			defaultValueType="$EnumeratedToken"
			cardinality="$Single"
		>
			<AllowedValues>
				<ValueIsOneOf values="$web,$app,$pdf,$epub,$print" />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="policySetRef"
			defaultValueType="$IriReference"
			cardinality="$Single"
			isReferenceTrait="true"
		/>

		<TraitDefinition
			name="compositionIri"
			defaultValueType="$IriReference"
			cardinality="$Single"
			isReferenceTrait="true"
		/>

		<TraitDefinition
			name="viewIri"
			defaultValueType="$IriReference"
			cardinality="$Single"
			isReferenceTrait="true"
		/>

		<TraitDefinition
			name="iri"
			defaultValueType="$IriReference"
			cardinality="$Single"
			isReferenceTrait="true"
		/>

		<TraitDefinition
			name="triple"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="selectedCandidate"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="selectedScore"
			defaultValueType="$Text"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="relaxOrder"
			defaultValueType="$Number"
			cardinality="$Single"
		/>

		<TraitDefinition
			name="relaxWeightClass"
			defaultValueType="$EnumeratedToken"
			cardinality="$Single"
		>
			<AllowedValues>
				<ValueIsOneOf values="$critical,$high,$medium,$low" />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="relaxationAction"
			defaultValueType="$EnumeratedToken"
			cardinality="$Single"
		>
			<AllowedValues>
				<ValueIsOneOf values="$dropTerm,$widenThreshold,$allowGroupSplit" />
			</AllowedValues>
		</TraitDefinition>
	</TraitDefinitions>
</Schema>
