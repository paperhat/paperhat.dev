<Schema
	id=codex:domain:adaptive-optimization-profile
	version="1.0.0"
	versionScheme=$Semver
	authoringMode=$SimplifiedMode
	compatibilityClass=$Initial
	namespace="adaptive-optimization"
	title="Adaptive Optimization Profile Schema"
	description="Deterministic optimization controls for adaptive layout selection."
>
	<ConceptDefinitions>
		<ConceptDefinition
			id=codex:domain:adaptive-optimization-profile:AdaptiveOptimizationProfile
			name="AdaptiveOptimizationProfile"
			conceptKind=$Semantic
			entityEligibility=$MustNotBeEntity
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

				<TraitRules>
					<RequiresTrait name="profileId" />

					<RequiresTrait name="solverMode" />

				<AllowsTrait name="quantizationMode" />

				<AllowsTrait name="reflowMode" />

				<AllowsTrait name="satisficeThreshold" />

				<AllowsTrait name="relaxationStrategy" />
			</TraitRules>

			<ChildRules>
				<AllowsChildConcept conceptSelector="OptimizationHardConstraint" />

				<AllowsChildConcept conceptSelector="OptimizationSoftTerm" />

				<AllowsChildConcept conceptSelector="RelaxationRule" />
			</ChildRules>

			<CollectionRules ordering=$Ordered allowsDuplicates=true />
		</ConceptDefinition>

		<ConceptDefinition
			id=codex:domain:adaptive-optimization-profile:OptimizationHardConstraint
			name="OptimizationHardConstraint"
			conceptKind=$Structural
			entityEligibility=$MustNotBeEntity
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

			<TraitRules>
				<RequiresTrait name="constraintKey" />

				<AllowsTrait name="constraintScope" />

				<AllowsTrait name="targetRef" />

				<AllowsTrait name="constraintValue" />
			</TraitRules>
		</ConceptDefinition>

		<ConceptDefinition
			id=codex:domain:adaptive-optimization-profile:OptimizationSoftTerm
			name="OptimizationSoftTerm"
			conceptKind=$Structural
			entityEligibility=$MustNotBeEntity
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

				<TraitRules>
					<RequiresTrait name="termKey" />

					<RequiresTrait name="weightClass" />

				<AllowsTrait name="termScope" />

				<AllowsTrait name="targetRef" />

				<AllowsTrait name="minimumSatisfaction" />
			</TraitRules>
		</ConceptDefinition>

		<ConceptDefinition
			id=codex:domain:adaptive-optimization-profile:RelaxationRule
			name="RelaxationRule"
			conceptKind=$Structural
			entityEligibility=$MustNotBeEntity
		>
			<ContentRules>
				<ForbidsContent />
			</ContentRules>

				<TraitRules>
					<RequiresTrait name="relaxOrder" />

					<RequiresTrait name="relaxWeightClass" />

					<RequiresTrait name="relaxationAction" />
				</TraitRules>
		</ConceptDefinition>
	</ConceptDefinitions>

	<TraitDefinitions>
		<TraitDefinition
			name="profileId"
			defaultValueType=$IriReference
			cardinality=$Single
			isReferenceTrait=true
		/>

			<TraitDefinition
				name="solverMode"
				defaultValueType=$EnumeratedToken
				cardinality=$Single
			>
				<AllowedValues>
					<ValueIsOneOf values=[ $weightedSum ] />
				</AllowedValues>
			</TraitDefinition>

		<TraitDefinition
			name="quantizationMode"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $continuous, $banded ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="reflowMode"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $reoptimizeEveryChange, $reoptimizeOnBandTransition ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="satisficeThreshold"
			defaultValueType=$Number
			cardinality=$Single
		/>

		<TraitDefinition
			name="relaxationStrategy"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $dropLowestWeightFirst, $widenThresholdsFirst, $allowScopedGroupSplit ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="constraintKey"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $mustNotOverlap, $minReadableFont, $preserveReadingOrder, $respectReducedMotion, $preserveGroupCohesion, $keepPrimaryVisible ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="constraintScope"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $global, $group, $local ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="termKey"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $proximity, $contrast, $alignment, $readability, $density, $negativeSpace, $motionEconomy, $performance, $localizationFidelity, $brandExpression ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="weightClass"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $critical, $high, $medium, $low ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="termScope"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $global, $group, $local ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="minimumSatisfaction"
			defaultValueType=$Number
			cardinality=$Single
		/>

		<TraitDefinition
			name="relaxOrder"
			defaultValueType=$Number
			cardinality=$Single
		/>

		<TraitDefinition
			name="relaxWeightClass"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $low, $medium, $high ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="relaxationAction"
			defaultValueType=$EnumeratedToken
			cardinality=$Single
		>
			<AllowedValues>
				<ValueIsOneOf values=[ $dropTerm, $widenThreshold, $allowGroupSplit ] />
			</AllowedValues>
		</TraitDefinition>

		<TraitDefinition
			name="targetRef"
			defaultValueType=$IriReference
			cardinality=$Single
			isReferenceTrait=true
		/>

		<TraitDefinition
			name="constraintValue"
			defaultValueType=$Text
			cardinality=$Single
		/>
	</TraitDefinitions>

	<ConstraintDefinitions>
		<ConstraintDefinition
			id=codex:domain:adaptive-optimization-profile:requires-soft-term
			title="AdaptiveOptimizationProfile must define at least one OptimizationSoftTerm"
		>
			<Targets>
				<TargetConcept conceptSelector="AdaptiveOptimizationProfile" />
			</Targets>

			<Rule>
				<ChildConstraint type=$RequiresChildConcept conceptSelector="OptimizationSoftTerm" />
			</Rule>
		</ConstraintDefinition>
	</ConstraintDefinitions>
</Schema>
